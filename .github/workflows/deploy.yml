name: Deploy to GitHub Pages

on:
  push:
    branches:
      - master # ou main, dependendo do seu branch padrão

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout 🛎️
        uses: actions/checkout@v4

      - name: Setup Node.js ⚙️
        uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'npm'

      - name: Install dependencies 🔧
        run: npm ci

      - name: Build Next.js app 🏗️
        run: npm run build
        # A exportação estática já é feita durante o build com output: 'export'
        
      - name: Copy .nojekyll file
        run: cp .nojekyll out/

      - name: Copy configuration files
        run: |
          cp _config.yml out/
          cp README.md out/
          cp index.html out/
          cp public/CNAME out/
          cp public/app-page.html out/
          
      - name: Create navigation scripts
        run: |
          # Cria um script para redirecionar para a página inicial
          echo '<!DOCTYPE html>
          <html>
            <head>
              <meta http-equiv="refresh" content="0;url=app/page/index.html">
              <script>window.location.href = "app/page/index.html";</script>
              <title>Redirecionando...</title>
            </head>
            <body>
              <p>Redirecionando para a página inicial...</p>
              <a href="app/page/index.html">Clique aqui se não for redirecionado automaticamente</a>
            </body>
          </html>' > out/navigate.html
          
          # Copia este script para locais estratégicos
          cp out/navigate.html out/index.html
          
      - name: Ensure index.html exists and verify files
        run: |
          # Verificar arquivos na pasta out
          echo "Verificando arquivos na pasta out:"
          ls -la out/
          
          # Verificar arquivos HTML
          echo "Verificando arquivos HTML:"
          find out -name "*.html" | sort
        
      - name: Deploy 🚀
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: out # pasta que o Next.js usa para saída estática
          branch: gh-pages # branch onde o código será implantado
          token: ${{ secrets.GITHUB_TOKEN }} 