name: Deploy to GitHub Pages

on:
  push:
    branches:
      - master # ou main, dependendo do seu branch padr√£o

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout üõéÔ∏è
        uses: actions/checkout@v4

      - name: Setup Node.js ‚öôÔ∏è
        uses: actions/setup-node@v4
        with:
          node-version: 18
          cache: 'npm'

      - name: Install dependencies üîß
        run: npm ci

      - name: Build Next.js app üèóÔ∏è
        run: npm run build
        # A exporta√ß√£o est√°tica j√° √© feita durante o build com output: 'export'
        
      - name: Copy .nojekyll file
        run: cp .nojekyll out/

      - name: Copy configuration files
        run: |
          cp _config.yml out/
          cp README.md out/
          cp index.html out/
          cp public/CNAME out/
          cp public/app-page.html out/
          
      - name: Create navigation scripts
        run: |
          # Cria um script para redirecionar para a p√°gina inicial
          echo '<!DOCTYPE html>
          <html>
            <head>
              <meta http-equiv="refresh" content="0;url=index.html">
              <script>window.location.href = "index.html";</script>
              <title>Redirecionando...</title>
            </head>
            <body>
              <p>Redirecionando para a p√°gina inicial...</p>
              <a href="index.html">Clique aqui se n√£o for redirecionado automaticamente</a>
            </body>
          </html>' > out/navigate.html
          
          # Verificar a estrutura de arquivos gerada
          find out -type f -name "*.html" | sort
          
          # Criar arquivo 404.html para redirecionamento
          echo '<!DOCTYPE html>
          <html>
            <head>
              <meta http-equiv="refresh" content="0;url=/">
              <script>window.location.href = "/";</script>
              <title>P√°gina n√£o encontrada</title>
              <style>
                body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }
                h1 { color: #f4bd50; }
                a { color: #f4bd50; }
              </style>
            </head>
            <body>
              <h1>P√°gina n√£o encontrada</h1>
              <p>Redirecionando para a p√°gina inicial...</p>
              <a href="/">Clique aqui se n√£o for redirecionado automaticamente</a>
            </body>
          </html>' > out/404.html
          
      - name: Ensure index.html exists and verify files
        run: |
          # Verificar arquivos na pasta out
          echo "Verificando arquivos na pasta out:"
          ls -la out/
          
          # Verificar arquivos HTML
          echo "Verificando arquivos HTML:"
          find out -name "*.html" | sort
          
          # Garantir que h√° um index.html na raiz
          if [ ! -f out/index.html ]; then
            cp out/navigate.html out/index.html
            echo "Criado index.html na raiz"
          fi
        
      - name: Deploy üöÄ
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: out # pasta que o Next.js usa para sa√≠da est√°tica
          branch: gh-pages # branch onde o c√≥digo ser√° implantado
          token: ${{ secrets.GITHUB_TOKEN }} 